message(STATUS "ENV{FATAL_ERRORS_FLAG} = '$ENV{FATAL_ERRORS_FLAG}'")

if(DEFINED ENV{FATAL_ERRORS_FLAG} AND $ENV{FATAL_ERRORS_FLAG} STREQUAL "ON")
  set(FATAL_ERRORS_FLAG ON CACHE BOOL "Treat warnings as errors" FORCE)
  message(STATUS "FATAL_ERRORS_FLAG is ON: enabling -Werror")
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Werror")
else()
  set(FATAL_ERRORS_FLAG OFF CACHE BOOL "Treat warnings as errors" FORCE)
  message(STATUS "FATAL_ERRORS_FLAG is OFF or not defined")
endif()

if(DEFINED ENV{FATAL_ERRORS_FLAG} AND $ENV{FATAL_ERRORS_FLAG} STREQUAL "ON")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wfatal-errors")
endif()

export FATAL_ERRORS_FLAG=ON
./production_iht_build.sh marlin "$@"